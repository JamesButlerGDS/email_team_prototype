{% extends "layout.html" %}

{% block page_title %}
  Manage your subscriptions
{% endblock %}

{% block content %}

{% set address = data.address | default('test@example.com') %}
{% set subscriptions = data.subscriptions | default([]) %}

<main id="content" role="main" class="manage">
  <div class="grid-row">
    <div class="column-two-thirds">

      <h1 class="heading-xlarge">
        Manage your subscriptions
      </h1>

      <script>
        if (window.location.href.indexOf("saved") !== -1) {
          document.write('<p class="saved-successfully">Your changes have been saved successfully.</p>');
        }
      </script>

      <span class="lede">
        Viewing subscriptions for {{ address }}
      </span>

      <h2 class="heading-large">Your subscriptions</h2>

      <ol class="subscriptions">
        {% for subscription in subscriptions %}
          {% set frequency = data[subscription.id + "-frequency"] | default('immediately') %}

          <li class="subscription" data-subscription="{{ subscription | dump }}" data-frequency="{{frequency}}">
            <h2 class="heading-medium">{{subscription.title}}</h2>
            <p>Received {{frequency}}</p>
            <a href="/edit?id={{subscription.id}}" class="button edit-subscription">Edit subscription</a>
            <button class="button unsubscribe">Unsubscribe</button>
          </li>
        {% endfor %}
      </ol>

      <h2 class="heading-large">Account settings</h2>

      <h2 class="heading-medium">Change your digest settings</h2>

      <p>
        You can get updates for each of your subscriptions immediately, or as daily or weekly digests.
      </p>

      <form action="/manage">
        <input type="hidden" name="saved" value="true">

        <div class="form-group">
          <fieldset>
            <legend>
              <h2 class="heading-medium">
                Change your email address
              </h2>
            </legend>

            <div class="panel panel-border-narrow">
              <label class="form-label" for="contact-email">Email address</label>
              <input class="form-control" type="text" id="address" name="address">
            </div>

            <input class="button" type="submit" value="Update email address">
          </fieldset>
        </div>
      </form>
    </div>
  </div>
  <a class="back-to-home" href="/">Back to homepage</a>
</main>

{% endblock %}
